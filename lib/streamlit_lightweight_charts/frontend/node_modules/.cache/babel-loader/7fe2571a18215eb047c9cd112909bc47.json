{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/michalmizera/Repos/StreamlitMiami/lib/streamlit_lightweight_charts/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _objectSpread from\"/Users/michalmizera/Repos/StreamlitMiami/lib/streamlit_lightweight_charts/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{useRenderData}from\"streamlit-component-lib-react-hooks\";import{createChart}from\"lightweight-charts\";import React,{useRef,useEffect}from\"react\";var LightweightChartsMultiplePanes=function LightweightChartsMultiplePanes(){// returns the renderData passed from Python\n// { args: object, disabled: boolean, theme: object }\nvar renderData=useRenderData();var chartsData=renderData.args[\"charts\"];var chartsContainerRef=useRef(null);var chartElRefs=Array(chartsData.length).fill(useRef(null));var chartRefs=useRef([]);useEffect(function(){if(chartElRefs.find(function(ref){return!ref.current;}))return;chartElRefs.forEach(function(ref,i){var chart=chartRefs.current[i]=createChart(ref.current,_objectSpread({height:300,width:chartElRefs[i].current.clientWidth},chartsData[i].chart));console.log('Charts data',chartsData);var _iterator=_createForOfIteratorHelper(chartsData[i].series),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var series=_step.value;var chartSeries=void 0;switch(series.type){case'Area':chartSeries=chart.addAreaSeries(series.options);break;case'Bar':chartSeries=chart.addBarSeries(series.options);break;case'Baseline':chartSeries=chart.addBaselineSeries(series.options);break;case'Candlestick':chartSeries=chart.addCandlestickSeries(series.options);chartSeries.createPriceLine({'price':29500,'color':\"#26a69a\",'lineWidth':2,'lineStyle':2,'axisLabelVisible':true,'title':\"my line\"});break;case'Histogram':chartSeries=chart.addHistogramSeries(series.options);break;case'Line':chartSeries=chart.addLineSeries(series.options);break;default:return;}console.log('Charts series',chartSeries);if(series.priceScale)chart.priceScale(series.options.priceScaleId||'').applyOptions(series.priceScale);chartSeries.setData(series.data);if(series.markers)chartSeries.setMarkers(series.markers);}}catch(err){_iterator.e(err);}finally{_iterator.f();}chart.timeScale().fitContent();});var charts=chartRefs.current.map(function(c){return c;});if(chartsData.length>1){// sync charts\ncharts.forEach(function(chart){if(!chart)return;chart.timeScale().subscribeVisibleTimeRangeChange(function(e){charts.filter(function(c){return c!==chart;}).forEach(function(c){c.timeScale().applyOptions({rightOffset:chart.timeScale().scrollPosition()});});});chart.timeScale().subscribeVisibleLogicalRangeChange(function(range){if(range){charts.filter(function(c){return c!==chart;}).forEach(function(c){c.timeScale().setVisibleLogicalRange({from:range===null||range===void 0?void 0:range.from,to:range===null||range===void 0?void 0:range.to});});}});// chart.subscribeCrosshairMove((handler) => {\n//   charts\n//     .filter((c) => c !== chart)\n//     .forEach((c) => {\n//       // if (handler.time !== undefined) {\n//       //   var xx = c.timeScale().timeToCoordinate(handler.time);\n//       //   c.setCrossHairXY(xx,50,true);\n//       // } else if (handler.point !== undefined){\n//       //   c.setCrossHairXY(handler.point.x,10,false);\n//       // }\n//       // c.timeScale().applyOptions({\n//       //   rightOffset: chart.timeScale().scrollPosition()\n//       // })\n//       console.log('handler',handler)\n//       if (handler.time !== undefined) {\n//         const xx = c.timeScale().timeToCoordinate(handler.time);\n//         if(xx) c.timeScale().scrollToPosition(xx,true)\n//         console.log('const xx',xx)\n//       }\n//     })\n// })\n});}// const handleResize = () => {\n//   chart.applyOptions({ width: chartsContainerRef?.current?.clientWidth })\n// }\n// window.addEventListener('resize', handleResize)\nreturn function(){// required because how useEffect() works\ncharts.forEach(function(chart){chart.remove();});};},[chartsData,chartElRefs,chartRefs]);return/*#__PURE__*/React.createElement(\"div\",{ref:chartsContainerRef},chartElRefs.map(function(ref,i){return/*#__PURE__*/React.createElement(\"div\",{ref:ref,id:\"lightweight-charts-\".concat(i),key:\"lightweight-charts-\".concat(i)});}));};export default LightweightChartsMultiplePanes;","map":{"version":3,"names":["useRenderData","createChart","React","useRef","useEffect","LightweightChartsMultiplePanes","renderData","chartsData","args","chartsContainerRef","chartElRefs","Array","length","fill","chartRefs","find","ref","current","forEach","i","chart","_objectSpread","height","width","clientWidth","console","log","_iterator","_createForOfIteratorHelper","series","_step","s","n","done","value","chartSeries","type","addAreaSeries","options","addBarSeries","addBaselineSeries","addCandlestickSeries","createPriceLine","addHistogramSeries","addLineSeries","priceScale","priceScaleId","applyOptions","setData","data","markers","setMarkers","err","e","f","timeScale","fitContent","charts","map","c","subscribeVisibleTimeRangeChange","filter","rightOffset","scrollPosition","subscribeVisibleLogicalRangeChange","range","setVisibleLogicalRange","from","to","remove","createElement","id","concat","key"],"sources":["/Users/michalmizera/Repos/StreamlitMiami/lib/streamlit_lightweight_charts/frontend/src/LightweightCharts.tsx"],"sourcesContent":["import { useRenderData } from \"streamlit-component-lib-react-hooks\"\nimport {\n  createChart,\n  IChartApi,\n} from \"lightweight-charts\"\nimport React, { useRef, useEffect } from \"react\"\n\nconst LightweightChartsMultiplePanes: React.VFC = () => {\n\n  // returns the renderData passed from Python\n  // { args: object, disabled: boolean, theme: object }\n  const renderData = useRenderData()\n  const chartsData = renderData.args[\"charts\"]\n\n  const chartsContainerRef = useRef<HTMLDivElement>(null)\n  const chartElRefs = Array(chartsData.length).fill(useRef<HTMLDivElement>(null))\n  const chartRefs = useRef<IChartApi[]>([])\n\n    useEffect(() => {\n      if (chartElRefs.find((ref) => !ref.current)) return;\n\n      chartElRefs.forEach((ref, i) => {\n        const chart = chartRefs.current[i] = createChart(\n          ref.current as HTMLDivElement,{\n            height: 300,\n            width: chartElRefs[i].current.clientWidth,\n            ...chartsData[i].chart,\n          }\n        );\n        console.log('Charts data', chartsData)\n        for (const series of chartsData[i].series){\n          \n          let chartSeries\n          switch(series.type) {\n            case 'Area':\n              chartSeries = chart.addAreaSeries(series.options)\n              break\n            case 'Bar':\n              chartSeries = chart.addBarSeries(series.options )\n              break\n            case 'Baseline':\n              chartSeries = chart.addBaselineSeries(series.options)\n              break\n            case 'Candlestick':\n              chartSeries = chart.addCandlestickSeries(series.options)\n              chartSeries.createPriceLine({\n            'price': 29500,\n            'color': \"#26a69a\",\n            'lineWidth': 2,\n            'lineStyle': 2,\n            'axisLabelVisible': true,\n            'title': \"my line\"\n        })\n              break\n            case 'Histogram':\n              chartSeries = chart.addHistogramSeries(series.options)\n              break\n            case 'Line':\n              chartSeries = chart.addLineSeries(series.options)\n              break\n            default:\n                return\n          }\n\n          console.log('Charts series', chartSeries)\n\n          if(series.priceScale)\n            chart.priceScale(series.options.priceScaleId || '').applyOptions(series.priceScale)\n\n          chartSeries.setData(series.data)\n\n          if(series.markers)\n            chartSeries.setMarkers(series.markers)\n\n        }\n\n        chart.timeScale().fitContent();\n\n      })\n  \n      const charts = chartRefs.current.map((c) => c as IChartApi);\n      \n      if(chartsData.length > 1){ // sync charts\n        charts.forEach((chart) => {\n          if (!chart) return;\n\n          chart.timeScale().subscribeVisibleTimeRangeChange((e) => {\n            charts\n              .filter((c) => c !== chart)\n              .forEach((c) => {\n                c.timeScale().applyOptions({\n                  rightOffset: chart.timeScale().scrollPosition()\n          }) }) })\n\n          chart.timeScale().subscribeVisibleLogicalRangeChange((range) => {\n            if (range) {\n              charts\n                .filter((c) => c !== chart)\n                .forEach((c) => {\n                  c.timeScale().setVisibleLogicalRange({\n                    from: range?.from,\n                    to: range?.to\n          }) }) } })\n\n          // chart.subscribeCrosshairMove((handler) => {\n          //   charts\n          //     .filter((c) => c !== chart)\n          //     .forEach((c) => {\n          //       // if (handler.time !== undefined) {\n          //       //   var xx = c.timeScale().timeToCoordinate(handler.time);\n          //       //   c.setCrossHairXY(xx,50,true);\n          //       // } else if (handler.point !== undefined){\n          //       //   c.setCrossHairXY(handler.point.x,10,false);\n          //       // }\n          //       // c.timeScale().applyOptions({\n          //       //   rightOffset: chart.timeScale().scrollPosition()\n          //       // })\n          //       console.log('handler',handler)\n          //       if (handler.time !== undefined) {\n          //         const xx = c.timeScale().timeToCoordinate(handler.time);\n          //         if(xx) c.timeScale().scrollToPosition(xx,true)\n          //         console.log('const xx',xx)\n          //       }\n          //     })\n          // })\n\n      }) }\n\n      // const handleResize = () => {\n      //   chart.applyOptions({ width: chartsContainerRef?.current?.clientWidth })\n      // }\n      // window.addEventListener('resize', handleResize)\n      return () => { // required because how useEffect() works\n        charts.forEach((chart) => {\n          chart.remove()\n        })\n      }\n\n    }, [ chartsData, chartElRefs, chartRefs])\n\n\n    return (\n      <div ref={chartsContainerRef}>\n        {chartElRefs.map((ref, i) => (\n          <div\n            ref={ref}\n            id={`lightweight-charts-${i}`}\n            key={`lightweight-charts-${i}`}\n          />\n        ))}\n      </div>\n    )\n\n}\n\nexport default LightweightChartsMultiplePanes\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}