{"version":3,"sources":["LightweightCharts.tsx","index.tsx"],"names":["LightweightChartsMultiplePanes","chartsData","useRenderData","args","chartsContainerRef","useRef","chartElRefs","Array","length","fill","chartRefs","useEffect","find","ref","current","forEach","i","chart","createChart","_objectSpread","height","width","clientWidth","console","log","_step","_iterator","_createForOfIteratorHelper","series","s","n","done","value","chartSeries","type","addAreaSeries","options","addBarSeries","addBaselineSeries","addCandlestickSeries","_step2","_iterator2","priceLines","lineData","createPriceLine","err","e","f","addHistogramSeries","addLineSeries","priceScale","priceScaleId","applyOptions","setData","data","markers","setMarkers","timeScale","fitContent","charts","map","c","subscribeVisibleTimeRangeChange","filter","rightOffset","scrollPosition","subscribeVisibleLogicalRangeChange","range","setVisibleLogicalRange","from","to","remove","React","createElement","id","concat","key","ReactDOM","render","StrictMode","StreamlitProvider","LightweightCharts","document","getElementById"],"mappings":"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","file":"static/js/main.b7abbabb.chunk.js","sourcesContent":["import { useRenderData } from \"streamlit-component-lib-react-hooks\"\nimport {\n  createChart,\n  IChartApi,\n} from \"lightweight-charts\"\nimport React, { useRef, useEffect } from \"react\"\n\nconst LightweightChartsMultiplePanes: React.VFC = () => {\n\n  // returns the renderData passed from Python\n  // { args: object, disabled: boolean, theme: object }\n  const renderData = useRenderData()\n  const chartsData = renderData.args[\"charts\"]\n\n  const chartsContainerRef = useRef<HTMLDivElement>(null)\n  const chartElRefs = Array(chartsData.length).fill(useRef<HTMLDivElement>(null))\n  const chartRefs = useRef<IChartApi[]>([])\n\n    useEffect(() => {\n      if (chartElRefs.find((ref) => !ref.current)) return;\n\n      chartElRefs.forEach((ref, i) => {\n        const chart = chartRefs.current[i] = createChart(\n          ref.current as HTMLDivElement,{\n            height: 300,\n            width: chartElRefs[i].current.clientWidth,\n            ...chartsData[i].chart,\n          }\n        );\n        console.log('Charts data', chartsData)\n        for (const series of chartsData[i].series){\n          \n          let chartSeries\n          switch(series.type) {\n            case 'Area':\n              chartSeries = chart.addAreaSeries(series.options)\n              break\n            case 'Bar':\n              chartSeries = chart.addBarSeries(series.options )\n              break\n            case 'Baseline':\n              chartSeries = chart.addBaselineSeries(series.options)\n              break\n            case 'Candlestick':\n              chartSeries = chart.addCandlestickSeries(series.options)\n              for (const lineData of series.priceLines){\n                chartSeries.createPriceLine(lineData)\n              }\n              break\n            case 'Histogram':\n              chartSeries = chart.addHistogramSeries(series.options)\n              break\n            case 'Line':\n              chartSeries = chart.addLineSeries(series.options)\n              break\n            default:\n                return\n          }\n\n          if(series.priceScale)\n            chart.priceScale(series.options.priceScaleId || '').applyOptions(series.priceScale)\n\n          chartSeries.setData(series.data)\n\n          if(series.markers)\n            chartSeries.setMarkers(series.markers)\n\n        }\n\n        chart.timeScale().fitContent();\n\n      })\n  \n      const charts = chartRefs.current.map((c) => c as IChartApi);\n      \n      if(chartsData.length > 1){ // sync charts\n        charts.forEach((chart) => {\n          if (!chart) return;\n\n          chart.timeScale().subscribeVisibleTimeRangeChange((e) => {\n            charts\n              .filter((c) => c !== chart)\n              .forEach((c) => {\n                c.timeScale().applyOptions({\n                  rightOffset: chart.timeScale().scrollPosition()\n          }) }) })\n\n          chart.timeScale().subscribeVisibleLogicalRangeChange((range) => {\n            if (range) {\n              charts\n                .filter((c) => c !== chart)\n                .forEach((c) => {\n                  c.timeScale().setVisibleLogicalRange({\n                    from: range?.from,\n                    to: range?.to\n          }) }) } })\n\n          // chart.subscribeCrosshairMove((handler) => {\n          //   charts\n          //     .filter((c) => c !== chart)\n          //     .forEach((c) => {\n          //       // if (handler.time !== undefined) {\n          //       //   var xx = c.timeScale().timeToCoordinate(handler.time);\n          //       //   c.setCrossHairXY(xx,50,true);\n          //       // } else if (handler.point !== undefined){\n          //       //   c.setCrossHairXY(handler.point.x,10,false);\n          //       // }\n          //       // c.timeScale().applyOptions({\n          //       //   rightOffset: chart.timeScale().scrollPosition()\n          //       // })\n          //       console.log('handler',handler)\n          //       if (handler.time !== undefined) {\n          //         const xx = c.timeScale().timeToCoordinate(handler.time);\n          //         if(xx) c.timeScale().scrollToPosition(xx,true)\n          //         console.log('const xx',xx)\n          //       }\n          //     })\n          // })\n\n      }) }\n\n      // const handleResize = () => {\n      //   chart.applyOptions({ width: chartsContainerRef?.current?.clientWidth })\n      // }\n      // window.addEventListener('resize', handleResize)\n      return () => { // required because how useEffect() works\n        charts.forEach((chart) => {\n          chart.remove()\n        })\n      }\n\n    }, [ chartsData, chartElRefs, chartRefs])\n\n\n    return (\n      <div ref={chartsContainerRef}>\n        {chartElRefs.map((ref, i) => (\n          <div\n            ref={ref}\n            id={`lightweight-charts-${i}`}\n            key={`lightweight-charts-${i}`}\n          />\n        ))}\n      </div>\n    )\n\n}\n\nexport default LightweightChartsMultiplePanes\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport { StreamlitProvider } from \"streamlit-component-lib-react-hooks\"\nimport LightweightCharts from \"./LightweightCharts\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <StreamlitProvider>\n      <LightweightCharts />\n    </StreamlitProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n"],"sourceRoot":""}