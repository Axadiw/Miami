{"ast":null,"code":"import{Streamlit}from\"streamlit-component-lib\";var targetWindow=window.parent||window;var targetDocument=targetWindow.document;var lastValue=null;function onRender(event){var data=event.detail;saveCookies(data.args[\"queue\"]);var newValue=targetDocument.cookie;if(lastValue!==newValue&&!data.args.saveOnly){Streamlit.setComponentValue(newValue);lastValue=newValue;}}Streamlit.events.addEventListener(Streamlit.RENDER_EVENT,onRender);Streamlit.setComponentReady();Streamlit.setFrameHeight(0);function saveCookies(queue){Object.keys(queue).forEach(function(name){var spec=queue[name];if(spec.value===null)targetDocument.cookie=\"\".concat(encodeURIComponent(name),\"=; max-age=0; path=\").concat(encodeURIComponent(spec.path));else{var date=new Date(spec.expires_at);console.log('saving cookie',\"\".concat(encodeURIComponent(name),\"=\").concat(encodeURIComponent(spec.value),\";\")+\" expires=\".concat(date.toUTCString(),\";\")+\" path=\".concat(encodeURIComponent(spec.path),\";\"));targetDocument.cookie=\"\".concat(encodeURIComponent(name),\"=\").concat(encodeURIComponent(spec.value),\";\")+\" expires=\".concat(date.toUTCString(),\";\")+\" path=\".concat(encodeURIComponent(spec.path),\";\");}});}","map":{"version":3,"sources":["/Users/michalmizera/Repos/StreamlitMiami/lib/streamlit_cookies_manager/src/index.ts"],"names":["Streamlit","targetWindow","window","parent","targetDocument","document","lastValue","onRender","event","data","detail","saveCookies","args","newValue","cookie","saveOnly","setComponentValue","events","addEventListener","RENDER_EVENT","setComponentReady","setFrameHeight","queue","Object","keys","forEach","name","spec","value","encodeURIComponent","path","date","Date","expires_at","console","log","toUTCString"],"mappings":"AAAA,OAAoBA,SAApB,KAAoC,yBAApC,CAEA,GAAMC,CAAAA,YAAoB,CAAGC,MAAM,CAACC,MAAP,EAAiBD,MAA9C,CACA,GAAME,CAAAA,cAAc,CAAGH,YAAY,CAACI,QAApC,CAEA,GAAIC,CAAAA,SAAwB,CAAG,IAA/B,CAeA,QAASC,CAAAA,QAAT,CAAkBC,KAAlB,CAAsC,CAClC,GAAMC,CAAAA,IAAI,CAAID,KAAD,CAAmCE,MAAhD,CAEAC,WAAW,CAACF,IAAI,CAACG,IAAL,CAAU,OAAV,CAAD,CAAX,CAEA,GAAMC,CAAAA,QAAQ,CAAGT,cAAc,CAACU,MAAhC,CACA,GAAIR,SAAS,GAAKO,QAAd,EAA0B,CAACJ,IAAI,CAACG,IAAL,CAAUG,QAAzC,CAAmD,CAC/Cf,SAAS,CAACgB,iBAAV,CAA4BH,QAA5B,EACAP,SAAS,CAAGO,QAAZ,CACH,CACJ,CAEDb,SAAS,CAACiB,MAAV,CAAiBC,gBAAjB,CAAkClB,SAAS,CAACmB,YAA5C,CAA0DZ,QAA1D,EACAP,SAAS,CAACoB,iBAAV,GACApB,SAAS,CAACqB,cAAV,CAAyB,CAAzB,EAGA,QAASV,CAAAA,WAAT,CAAqBW,KAArB,CAA2D,CACvDC,MAAM,CAACC,IAAP,CAAYF,KAAZ,EAAmBG,OAAnB,CAA2B,SAACC,IAAD,CAAU,CACjC,GAAMC,CAAAA,IAAI,CAAGL,KAAK,CAACI,IAAD,CAAlB,CACA,GAAIC,IAAI,CAACC,KAAL,GAAe,IAAnB,CACIxB,cAAc,CAACU,MAAf,WAA2Be,kBAAkB,CAACH,IAAD,CAA7C,+BAAyEG,kBAAkB,CAACF,IAAI,CAACG,IAAN,CAA3F,EADJ,IAEK,CACD,GAAMC,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAASL,IAAI,CAACM,UAAd,CAAb,CACAC,OAAO,CAACC,GAAR,CAAY,eAAZ,CACI,UAAGN,kBAAkB,CAACH,IAAD,CAArB,aAA+BG,kBAAkB,CAACF,IAAI,CAACC,KAAN,CAAjD,yBACYG,IAAI,CAACK,WAAL,EADZ,sBAESP,kBAAkB,CAACF,IAAI,CAACG,IAAN,CAF3B,KADJ,EAKA1B,cAAc,CAACU,MAAf,CACI,UAAGe,kBAAkB,CAACH,IAAD,CAArB,aAA+BG,kBAAkB,CAACF,IAAI,CAACC,KAAN,CAAjD,yBACYG,IAAI,CAACK,WAAL,EADZ,sBAESP,kBAAkB,CAACF,IAAI,CAACG,IAAN,CAF3B,KADJ,CAKH,CACJ,CAjBD,EAkBH","sourcesContent":["import {RenderData, Streamlit} from \"streamlit-component-lib\"\n\nconst targetWindow: Window = window.parent || window\nconst targetDocument = targetWindow.document\n\nlet lastValue: string | null = null\n\ninterface AddCookieSpec {\n    value: string\n    expires_at: string\n    path: string\n}\n\ninterface DeleteCookieSpec {\n    value: null\n    path: string\n}\n\ntype CookieSpec = AddCookieSpec | DeleteCookieSpec\n\nfunction onRender(event: Event): void {\n    const data = (event as CustomEvent<RenderData>).detail\n\n    saveCookies(data.args[\"queue\"])\n\n    const newValue = targetDocument.cookie\n    if (lastValue !== newValue && !data.args.saveOnly) {\n        Streamlit.setComponentValue(newValue)\n        lastValue = newValue\n    }\n}\n\nStreamlit.events.addEventListener(Streamlit.RENDER_EVENT, onRender)\nStreamlit.setComponentReady()\nStreamlit.setFrameHeight(0)\n\n\nfunction saveCookies(queue: { [k in string]: CookieSpec }) {\n    Object.keys(queue).forEach((name) => {\n        const spec = queue[name]\n        if (spec.value === null)\n            targetDocument.cookie = `${encodeURIComponent(name)}=; max-age=0; path=${encodeURIComponent(spec.path)}`\n        else {\n            const date = new Date(spec.expires_at)\n            console.log('saving cookie', (\n                `${encodeURIComponent(name)}=${encodeURIComponent(spec.value)};` +\n                ` expires=${date.toUTCString()};` +\n                ` path=${encodeURIComponent(spec.path)};`\n            ))\n            targetDocument.cookie = (\n                `${encodeURIComponent(name)}=${encodeURIComponent(spec.value)};` +\n                ` expires=${date.toUTCString()};` +\n                ` path=${encodeURIComponent(spec.path)};`\n            )\n        }\n    })\n}"]},"metadata":{},"sourceType":"module"}